==========MATLAB code==========
syms x1 x2 x3 x4 y1 y2 y3 y4 f1 f2 f3 f4 w t


H = [ x1, y1, f1;
x2, y2, f2;
x3, y3, f3;
x4, y4, f4;
];

Hx = [ 
0, -1;
1, -2;
2, 2;
-2, 2;
];

Hy = zeros(4 , 2);


for i = 1:4
j = rem(i+2, 4) + 1;
k = rem(i+3, 4) + 1;

Kx = H(j,1) + Hx(k,1)*cos(H(j,3)) - Hy(k,1)*sin(H(j,3)) - H(k,1)-Hx(k,2)*cos(H(k,3)) + Hy(k,2)*sin(H(k,3));
Ky = H(j,2) + Hx(k,1)*sin(H(j,3)) + Hy(k,1)*cos(H(j,3)) - H(k,2)-Hx(k,2)*sin(H(k,3)) - Hy(k,2)*cos(H(k,3));

G((2*i-1),1) = Kx;
G(2*i,1) = Ky;

end

A = [x4; y4; f4; f4-w*t];
G = [G; A];
fprintf('回転ジョイントの拘束式\n');
disp(G);

J = jacobian(G, [x1 y1 f1 x2 y2 f2 x3 y3 f3 x4 y4 f4]);
fprintf('ヤコビアン\n');
disp(J);

Ft = diff(G,t);
Ftt = diff(Ft,t);
Fqt = diff(J,t);

fprintf('Ftt\n');
disp(Ftt);
fprintf('Fqt\n');
disp(Fqt);
==========Result==========
回転ジョイントの拘束式
x4 - x1 + cos(f1)
y4 - y1 + sin(f1)
x1 - x2 + cos(f1) + 2*cos(f2)
y1 - y2 + sin(f1) + 2*sin(f2)
x2 - x3 + 2*cos(f2) - 2*cos(f3)
y2 - y3 + 2*sin(f2) - 2*sin(f3)
x3 - x4 - 2*cos(f3) - 2*cos(f4)
y3 - y4 - 2*sin(f3) - 2*sin(f4)
x4
y4
f4
f4 - t*w

ヤコビアン
[ -1, 0, -sin(f1), 0, 0, 0, 0, 0, 0, 1, 0, 0]
[ 0, -1, cos(f1), 0, 0, 0, 0, 0, 0, 0, 1, 0]
[ 1, 0, -sin(f1), -1, 0, -2*sin(f2), 0, 0, 0, 0, 0, 0]
[ 0, 1, cos(f1), 0, -1, 2*cos(f2), 0, 0, 0, 0, 0, 0]
[ 0, 0, 0, 1, 0, -2*sin(f2), -1, 0, 2*sin(f3), 0, 0, 0]
[ 0, 0, 0, 0, 1, 2*cos(f2), 0, -1, -2*cos(f3), 0, 0, 0]
[ 0, 0, 0, 0, 0, 0, 1, 0, 2*sin(f3), -1, 0, 2*sin(f4)]
[ 0, 0, 0, 0, 0, 0, 0, 1, -2*cos(f3), 0, -1, -2*cos(f4)]
[ 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0]
[ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0]
[ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1]
[ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1]

Ftt
0
0
0
0
0
0
0
0
0
0
0
0

Fqt
[ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
[ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
[ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
[ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
[ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
[ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
[ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
[ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
[ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
[ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
[ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
[ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0] 
2016-05-08 10:56